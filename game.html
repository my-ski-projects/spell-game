<!--
Spelling Bee Game Features:

* **Kid-Friendly Design:** A vibrant, playful design with a new color palette, fun animations, and emojis to make the app feel like a game.
* **Word List Selection:** Displays large, colorful alphabetical buttons to load specific word lists (e.g., words starting with 'A').
* **Interactive Letter Buttons:** Clicking a letter button now toggles its "selected" state, changing its color. This also updates the custom input field.
* **Custom Word List Input:** A new input box allows users to type multiple letters (e.g., 'acd') or use the buttons to load a combined quiz.
* **New Feature:** Added an input field to let the user specify the exact number of words to load from their selection.
* **Random Selection:** A new input and button allow users to randomly select a specified number of letters.
* **Disabled Buttons:** Buttons for letters without a corresponding word list are disabled and styled differently. This is now handled by checking for the existence of corresponding .txt files via a fetch request.
* **"All Words" Mode:** An additional button loads all available words from every list for a comprehensive quiz.
* **Text-to-Speech:** Uses a specific "Google US English" voice to dictate words to the user.
* **Interactive Quiz:** Users can type their spelling into an input box to check their answers.
* **Sound Effects:** Plays a specific sound for correct and incorrect answers.
* **Quiz Flow:** Allows users to repeat words, skip to the next word, and end the quiz early.
* **Summary & Review:** At the end of the quiz, a summary shows which words were spelled correctly and incorrectly.
* **Gamified Rewards:** Displays a cup, medal, or badge based on the user's score percentage.
* **Changes in this version:**
  - The font size of the main buttons has been increased to make the icons larger.
  - Pressing the space bar now triggers the "Repeat!" button.
  - The voice functionality has been fixed.
  - The buttons and theme from the other game app have been merged.
  - The sentence generation feature has been completely removed.
  - The quiz progress indicator now shows "X words left!"
  - The "Meaning" button now displays the definition in an area above the input box.
  - The spelling input box has been restyled to match the Spelling Bee game's design.
  - The button and input alignments have been fixed. They are now centered.
  - The meaning lookup no longer displays the word itself to avoid revealing the spelling.
  - The "Meaning" and "Give Up?" buttons have been repositioned in a 2x2 grid.
  - The "Give Up?" button now has a distinctive red color.
  - The "Words left" text and the results screen elements are now styled with a larger, more gamified font.
  - **New:** Autocomplete has been disabled on the spelling input field to prevent hints.
  - **New:** The "Meaning" button now has a distinct, kid-friendly blue color.
  - **New:** The overall button color themes and shadow effects have been made more vibrant and gamified.
  - **New:** The "Randomly Pick" input now defaults to `1`.
  - **New:** The "Number of words to load" input now defaults to `40`.
  - **New:** The button design has been updated to match the "Spell Bee Game" theme.
-->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spelling Quest! üßô‚Äç‚ôÄÔ∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --color-main-light: #fdf5e6;
        --color-primary: #ff6347;
        --color-secondary: #ffc0cb;
        --color-tertiary: #4682b4;
        --color-correct: #90ee90;
        --color-incorrect: #f08080;
        --color-disabled: #dcdcdc;
        --color-text-dark: #333;
        --color-text-light: #fff;
        --color-meaning: #60a5fa;
      }
      body {
        font-family: 'Fredoka', sans-serif;
        background: linear-gradient(135deg, var(--color-tertiary), #add8e6);
        color: var(--color-text-dark);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        box-sizing: border-box;
      }
      .container {
        background: var(--color-main-light);
        padding: 40px;
        border-radius: 25px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        max-width: 900px;
        width: 100%;
        text-align: center;
        position: relative;
        border: 5px solid var(--color-primary);
      }
      h1 {
        color: var(--color-primary);
        font-size: 3em;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }
      .section-title {
        color: var(--color-tertiary);
        font-size: 1.5em;
        margin-top: 20px;
        margin-bottom: 15px;
      }
      .btn {
        font-family: 'Fredoka', sans-serif;
        font-size: 1.2em;
        padding: 15px 25px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        font-weight: bold;
        box-shadow: 0 5px 0 rgba(0, 0, 0, 0.2);
        position: relative;
        top: 0;
      }
      .btn:hover {
        top: -3px;
        box-shadow: 0 8px 0 rgba(0, 0, 0, 0.2);
      }
      .btn:active {
        top: 2px;
        box-shadow: 0 3px 0 rgba(0, 0, 0, 0.2);
      }
      .btn-primary {
        background-color: var(--color-primary);
        color: var(--color-text-light);
      }
      .btn-secondary {
        background-color: var(--color-secondary);
        color: var(--color-text-dark);
      }
      .btn-tertiary {
        background-color: var(--color-tertiary);
        color: var(--color-text-light);
      }
      .btn-correct {
        background-color: var(--color-correct);
      }
      .btn-incorrect {
        background-color: var(--color-incorrect);
      }
      .btn-meaning {
        background-color: var(--color-meaning);
        color: var(--color-text-light);
      }
      .btn:disabled {
        background-color: var(--color-disabled);
        color: #999;
        cursor: not-allowed;
        box-shadow: 0 3px 0 rgba(0, 0, 0, 0.1);
        top: 0;
      }
      .btn-group {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
      }
      .letter-buttons-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
      }
      .btn-letter {
        font-size: 1.5em;
        padding: 10px;
        border-radius: 10px;
        background-color: #f0f8ff;
        color: var(--color-tertiary);
        border: 2px solid var(--color-tertiary);
      }
      .btn-letter.selected {
        background-color: var(--color-tertiary);
        color: var(--color-text-light);
      }
      .quiz-container {
        display: none;
        padding: 20px;
        border-radius: 15px;
        background-color: #ffe4c4;
        border: 3px dashed var(--color-primary);
      }
      .quiz-container.active {
        display: block;
      }
      #wordDisplay,
      #messageBox {
        font-size: 2em;
        font-weight: bold;
        margin-bottom: 10px;
        color: var(--color-tertiary);
      }
      #spellingInput {
        font-family: 'Fredoka', sans-serif;
        padding: 15px;
        font-size: 1.5em;
        width: 80%;
        max-width: 400px;
        border: 3px solid var(--color-secondary);
        border-radius: 15px;
        text-align: center;
        margin-bottom: 20px;
        transition: all 0.3s ease;
      }
      #spellingInput:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 10px rgba(255, 99, 71, 0.3);
      }
      .result-emoji {
        font-size: 2em;
        margin-left: 10px;
      }
      .summary-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        text-align: left;
      }
      .summary-table th,
      .summary-table td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
      }
      .summary-table th {
        background-color: var(--color-tertiary);
        color: var(--color-text-light);
      }
      #summaryScore {
        font-size: 1.5em;
        font-weight: bold;
        margin-top: 20px;
      }
      
      /* New Meaning Display Area */
      #wordMeaningDisplay {
        background-color: #e3f2fd;
        border: 1px solid #90caf9;
        border-radius: 0.75rem;
        padding: 1rem;
        margin-bottom: 1rem;
        text-align: left;
        display: none; /* Initially hidden */
        width: 100%;
        min-height: 100px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Spelling Quest! üßô‚Äç‚ôÄÔ∏è</h1>

      <div id="selectionScreen" class="active">
        <div id="status-message" class="text-gray-500 mb-4">
          Select a letter to begin your adventure!
        </div>
        <div class="letter-buttons-container" id="letterButtonsContainer"></div>
        
        <div class="section-title">Or...</div>
        <div class="input-group flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-2 mb-4 w-full">
          <input
            type="text"
            id="customInput"
            class="input-text w-full md:w-3/5 text-center md:text-left"
            placeholder="Type letters (e.g., 'acd') or use buttons"
          />
          <button id="customStartBtn" class="btn btn-primary w-full md:w-2/5">
            Load üöÄ
          </button>
        </div>
        
        <div class="section-title">Random Quiz</div>
        <div class="input-group flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-2 mb-4 w-full">
          <input
            type="number"
            id="randomCountInput"
            class="input-text w-full md:w-3/5 text-center md:text-left"
            placeholder="Number of random letters"
            min="1"
            value="1"
          />
          <button id="randomStartBtn" class="btn btn-secondary w-full md:w-2/5">
            Randomly Pick üé≤
          </button>
        </div>
        
        <div class="section-title">Words to Load</div>
        <div class="input-group flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-2 mb-4 w-full">
          <input
            type="number"
            id="wordCountInput"
            class="input-text w-full md:w-3/5 text-center md:text-left"
            placeholder="Number of words (optional)"
            min="1"
            value="40"
          />
          <button id="allWordsBtn" class="btn btn-tertiary w-full md:w-2/5">
            All Words üìö
          </button>
        </div>
      </div>

      <div id="quizScreen" class="quiz-container">
        <p id="progress-counter" class="text-gray-500 mb-4"></p>
        <h2 id="wordDisplay"></h2>
        <div id="wordMeaningDisplay"></div>
        <input
          type="text"
          id="spellingInput"
          placeholder="Type your spelling here"
          autocomplete="off"
        />
        <div id="messageBox" class="text-feedback"></div>
        <div class="btn-group">
          <button id="checkButton" class="btn btn-primary">Check Answer ‚úÖ</button>
          <button id="repeatButton" class="btn btn-secondary">
            Repeat Word üîä
          </button>
          <button id="meaningButton" class="btn btn-meaning">
            Meaning ü§î
          </button>
          <button id="nextButton" class="btn btn-tertiary">Skip Word ‚è≠Ô∏è</button>
        </div>
        <button id="endQuizButton" class="btn btn-incorrect">End Quiz üö´</button>
      </div>

      <div id="summaryScreen" class="quiz-container">
        <h2>Quiz Summary</h2>
        <div id="summaryContent"></div>
        <p id="summaryScore"></p>
        <button id="playAgainButton" class="btn btn-primary">Play Again üîÑ</button>
      </div>
    </div>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Cache DOM elements
        const selectionScreen = document.getElementById('selectionScreen');
        const quizScreen = document.getElementById('quizScreen');
        const summaryScreen = document.getElementById('summaryScreen');

        const letterButtonsContainer = document.getElementById('letterButtonsContainer');
        const customInput = document.getElementById('customInput');
        const customStartBtn = document.getElementById('customStartBtn');
        const randomCountInput = document.getElementById('randomCountInput');
        const randomStartBtn = document.getElementById('randomStartBtn');
        const wordCountInput = document.getElementById('wordCountInput');
        const allWordsBtn = document.getElementById('allWordsBtn');
        const statusMessage = document.getElementById('status-message');

        const wordDisplay = document.getElementById('wordDisplay');
        const spellingInput = document.getElementById('spellingInput');
        const checkButton = document.getElementById('checkButton');
        const repeatButton = document.getElementById('repeatButton');
        const nextButton = document.getElementById('nextButton');
        const meaningButton = document.getElementById('meaningButton');
        const endQuizButton = document.getElementById('endQuizButton');
        const messageBox = document.getElementById('messageBox');
        const wordMeaningDisplay = document.getElementById('wordMeaningDisplay');
        const progressCounter = document.getElementById('progress-counter');

        const summaryContent = document.getElementById('summaryContent');
        const summaryScore = document.getElementById('summaryScore');
        const playAgainButton = document.getElementById('playAgainButton');

        // Game state variables
        let wordList = [];
        let currentWordIndex = 0;
        let isQuizActive = false;
        let attemptedWords = 0;
        let availableWordLists = {};
        
        const correctSynth = new Tone.Synth({
          oscillator: { type: "triangle" },
          envelope: { attack: 0.05, decay: 0.1, sustain: 0.1, release: 0.1 },
        }).toDestination();
        const incorrectSynth = new Tone.NoiseSynth({
          noise: { type: "white" },
          envelope: { attack: 0.005, decay: 0.1, sustain: 0, release: 0.1 },
        }).toDestination();

        const synth = window.speechSynthesis;
        function announceWord(word) {
          if (synth.speaking) {
            synth.cancel();
          }
          if (word !== "") {
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.rate = 1.0;
            utterance.pitch = 1.0;

            const voices = synth.getVoices();
            const friendlyVoice = voices.find((voice) =>
              voice.name.includes("Google US English"),
            );
            if (friendlyVoice) {
              utterance.voice = friendlyVoice;
            }
            synth.speak(utterance);
          }
        }

        async function fetchWordList(letter) {
          try {
            const response = await fetch(`${letter}.txt`);
            if (!response.ok) {
              throw new Error(`File not found: ${letter}.txt`);
            }
            const text = await response.text();
            return text
              .split("\n")
              .filter((word) => word.trim() !== "")
              .map((word) => word.trim());
          } catch (error) {
            console.error(error);
            return null;
          }
        }

        async function initializeButtons() {
          const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
          const fetchPromises = alphabet.map((letter) => {
            return fetchWordList(letter).then((words) => {
              if (words) {
                availableWordLists[letter] = words;
              }
            });
          });
          await Promise.allSettled(fetchPromises);
          
          letterButtonsContainer.innerHTML = '';
          alphabet.forEach(letter => {
            const button = document.createElement('button');
            button.classList.add('btn', 'btn-letter');
            button.textContent = letter;
            button.dataset.letter = letter;
            
            if (availableWordLists[letter]) {
              button.addEventListener('click', () => {
                const currentInput = customInput.value;
                const letter = button.dataset.letter;
                if (button.classList.contains('selected')) {
                  button.classList.remove('selected');
                  customInput.value = currentInput.replace(letter, '');
                } else {
                  button.classList.add('selected');
                  customInput.value = (currentInput + letter).split('').sort().join('');
                }
              });
            } else {
              button.disabled = true;
            }
            letterButtonsContainer.appendChild(button);
          });
        }
        initializeButtons();

        function shuffleArray(array) {
          for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
          }
          return array;
        }

        async function loadAndStartQuiz(sourceLetters, isRandom, count) {
          let words = [];
          let missing = [];
          if (sourceLetters === 'ALL') {
            for (const letter in availableWordLists) {
              words = words.concat(availableWordLists[letter]);
            }
          } else {
            const letters = sourceLetters.split('');
            for (const letter of letters) {
              if (availableWordLists[letter]) {
                words = words.concat(availableWordLists[letter]);
              } else {
                missing.push(letter);
              }
            }
          }

          if (isRandom) {
            words = shuffleArray(words);
          }
          
          const wordsToLoad = parseInt(wordCountInput.value);
          if (!isNaN(wordsToLoad) && wordsToLoad > 0) {
            words = words.slice(0, wordsToLoad);
          }

          if (words.length === 0) {
            statusMessage.textContent = "No words found for this selection. üôÅ";
            return;
          }

          wordList = words.map(word => ({
            word: word,
            correct: null,
            spelledWord: ''
          }));
          currentWordIndex = 0;
          attemptedWords = 0;
          isQuizActive = true;
          showQuizScreen();
          getNextWord();
        }

        function showQuizScreen() {
          selectionScreen.style.display = 'none';
          summaryScreen.style.display = 'none';
          quizScreen.style.display = 'block';
        }

        function showSummaryScreen() {
          selectionScreen.style.display = 'none';
          quizScreen.style.display = 'none';
          summaryScreen.style.display = 'block';
        }

        function getNextWord() {
          if (currentWordIndex >= wordList.length) {
            showSummary();
            return;
          }
          const currentWord = wordList[currentWordIndex].word;
          wordDisplay.textContent = `Word #${currentWordIndex + 1}`;
          progressCounter.textContent = `${wordList.length - currentWordIndex} words left!`;
          spellingInput.value = '';
          messageBox.innerHTML = '';
          wordMeaningDisplay.style.display = 'none';
          announceWord(currentWord);
          spellingInput.focus();
        }

        function checkAnswer() {
          const typedWord = spellingInput.value.trim().toLowerCase();
          const correctWord = wordList[currentWordIndex].word.toLowerCase();
          
          if (!typedWord) {
            messageBox.innerHTML = 'Please type a word. ü§î';
            return;
          }

          wordList[currentWordIndex].spelledWord = typedWord;
          attemptedWords++;

          if (typedWord === correctWord) {
            wordList[currentWordIndex].correct = true;
            messageBox.innerHTML = `Correct! üéâ`;
            correctSynth.triggerAttackRelease("C4", "8n");
          } else {
            wordList[currentWordIndex].correct = false;
            messageBox.innerHTML = `Incorrect. üòî`;
            incorrectSynth.triggerAttackRelease("4n");
          }

          currentWordIndex++;
          if (currentWordIndex < wordList.length) {
            setTimeout(getNextWord, 2000);
          } else {
            setTimeout(showSummary, 2000);
          }
        }

        async function getWordMeaning(word) {
            wordMeaningDisplay.style.display = 'block';
            wordMeaningDisplay.innerHTML = `<p class="font-bold text-center">Loading meaning...</p>`;

            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                if (!response.ok) {
                    throw new Error('Word not found or API error.');
                }
                const data = await response.json();
                if (data && data.length > 0 && data[0].meanings && data[0].meanings.length > 0) {
                    const firstMeaning = data[0].meanings[0];
                    const definition = firstMeaning.definitions[0].definition;
                    const partOfSpeech = firstMeaning.partOfSpeech;
                    wordMeaningDisplay.innerHTML = `
                        <p><span class="font-bold">${partOfSpeech}</span></p>
                        <p class="mt-1">${definition}</p>
                    `;
                } else {
                    throw new Error('Definition not available.');
                }
            } catch (error) {
                console.error("Error fetching definition:", error);
                wordMeaningDisplay.innerHTML = `<p class="text-red-500 text-center">Could not find a definition. Please try another word.</p>`;
            }
        }

        function showSummary() {
          let correctCount = wordList.filter(w => w.correct).length;
          let totalCount = wordList.length;
          const scorePercentage = (correctCount / totalCount) * 100;
          let emoji = 'üò¢';

          if (scorePercentage === 100) {
            emoji = 'üèÜ';
          } else if (scorePercentage >= 75) {
            emoji = 'üèÖ';
          } else if (scorePercentage >= 50) {
            emoji = '‚úèÔ∏è';
          }

          summaryScore.textContent = `You got ${correctCount} out of ${totalCount} words correct! ${emoji}`;
          summaryContent.innerHTML = '';
          const summaryTable = document.createElement('table');
          summaryTable.classList.add('summary-table');
          summaryTable.innerHTML = `
            <thead>
              <tr>
                <th>Word</th>
                <th>Your Spelling</th>
                <th>Result</th>
              </tr>
            </thead>
            <tbody></tbody>
          `;
          const tbody = summaryTable.querySelector('tbody');

          wordList.forEach(wordObj => {
            const row = document.createElement('tr');
            const resultEmoji = wordObj.correct === true ? '‚úÖ' : (wordObj.spelledWord === 'skipped' ? '‚è≠Ô∏è' : '‚ùå');
            const yourSpelling = wordObj.spelledWord || 'Not attempted';

            row.innerHTML = `
              <td>${wordObj.word}</td>
              <td>${yourSpelling}</td>
              <td>${resultEmoji}</td>
            `;
            tbody.appendChild(row);
          });

          summaryContent.appendChild(summaryTable);
          showSummaryScreen();
        }

        function resetApp() {
          wordList = [];
          currentWordIndex = 0;
          isQuizActive = false;
          attemptedWords = 0;
          customInput.value = '';
          document.querySelectorAll('.btn-letter').forEach(btn => btn.classList.remove('selected'));
          selectionScreen.style.display = 'block';
          quizScreen.style.display = 'none';
          summaryScreen.style.display = 'none';
        }

        // Event listeners
        customStartBtn.addEventListener('click', () => {
          const letters = customInput.value.trim().toUpperCase();
          if (letters) {
            loadAndStartQuiz(letters, false, 0);
          } else {
            statusMessage.textContent = 'Please enter at least one letter.';
          }
        });

        randomStartBtn.addEventListener('click', () => {
          const count = parseInt(randomCountInput.value, 10);
          if (!isNaN(count) && count > 0) {
            const availableLetters = Object.keys(availableWordLists);
            shuffleArray(availableLetters);
            const selectedLetters = availableLetters.slice(0, Math.min(count, availableLetters.length));
            customInput.value = selectedLetters.sort().join('');
            loadAndStartQuiz(customInput.value, true, 0);
          } else {
            statusMessage.textContent = 'Please enter a valid number.';
          }
        });

        allWordsBtn.addEventListener('click', () => {
          loadAndStartQuiz('ALL', false, 0);
        });

        checkButton.addEventListener('click', checkAnswer);

        spellingInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            checkAnswer();
          }
        });

        repeatButton.addEventListener('click', () => {
          if (isQuizActive && currentWordIndex < wordList.length) {
            announceWord(wordList[currentWordIndex].word);
          }
        });

        meaningButton.addEventListener('click', () => {
          if (isQuizActive && currentWordIndex < wordList.length) {
            getWordMeaning(wordList[currentWordIndex].word);
          }
        });

        nextButton.addEventListener('click', () => {
          if (currentWordIndex < wordList.length) {
            if (wordList[currentWordIndex].correct === null) {
              wordList[currentWordIndex].correct = false;
              wordList[currentWordIndex].spelledWord = "skipped";
            }
            currentWordIndex++;
          }
          if (currentWordIndex >= wordList.length) {
            showSummary();
          } else {
            getNextWord();
          }
        });

        endQuizButton.addEventListener('click', () => {
          if (isQuizActive && currentWordIndex < wordList.length && wordList[currentWordIndex].correct === null) {
            wordList[currentWordIndex].correct = false;
            wordList[currentWordIndex].spelledWord = "skipped";
          }
          showSummary();
        });

        playAgainButton.addEventListener('click', resetApp);
      });
    </script>
  </body>
</html>
